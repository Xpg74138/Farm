var b=Object.defineProperty;var k=(c,e,t)=>e in c?b(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var n=(c,e,t)=>k(c,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class _{constructor(e){n(this,"currentRoute");n(this,"routes");n(this,"rootElement");this.currentRoute="start",this.routes=new Map,this.rootElement=e,window.addEventListener("hashchange",()=>{this.handleHashChange()})}registerRoute(e,t){this.routes.set(e,t),t.className=`page ${e===this.currentRoute?"":"hidden"}`,this.rootElement.appendChild(t)}navigate(e){if(this.routes.has(e)){const t=this.routes.get(this.currentRoute);t&&t.classList.add("hidden");const a=this.routes.get(e);a&&a.classList.remove("hidden"),this.currentRoute=e,window.location.hash=e}}getCurrentRoute(){return this.currentRoute}handleHashChange(){const e=window.location.hash.slice(1)||"start";this.routes.has(e)&&this.navigate(e)}init(){const e=window.location.hash.slice(1)||"start";this.navigate(e)}}class A{constructor(){n(this,"state");n(this,"BASE_MAX_PIGS",5);n(this,"PEN_UPGRADE_COST",1e3);n(this,"PEN_UPGRADE_INCREASE",5);n(this,"FEED_PER_PIG",2);this.state=this.getInitialState()}getInitialState(){return{money:1e3,feedStock:50,feedConsumption:2*this.FEED_PER_PIG,fatteningPigs:2,readyPigs:0,maxPigs:this.BASE_MAX_PIGS}}getState(){return{...this.state}}setState(e){this.state={...this.state,...e}}buyFeed(e,t){const a=parseFloat((e*t).toFixed(2));return this.state.money<a?!1:(this.state.money=parseFloat((this.state.money-a).toFixed(2)),this.state.feedStock=parseFloat((this.state.feedStock+e).toFixed(2)),!0)}buyPig(e,t){const a=parseFloat((e*t).toFixed(2)),s=this.state.fatteningPigs+this.state.readyPigs+e;return this.state.money<a||s>this.state.maxPigs?!1:(this.state.money=parseFloat((this.state.money-a).toFixed(2)),this.state.fatteningPigs=parseFloat((this.state.fatteningPigs+e).toFixed(2)),!0)}sellPig(e,t){if(this.state.readyPigs<e)return!1;const a=parseFloat((e*t).toFixed(2));return this.state.money=parseFloat((this.state.money+a).toFixed(2)),this.state.readyPigs=parseFloat((this.state.readyPigs-e).toFixed(2)),!0}upgradePen(){return this.state.money<this.PEN_UPGRADE_COST?!1:(this.state.money=parseFloat((this.state.money-this.PEN_UPGRADE_COST).toFixed(2)),this.state.maxPigs=parseFloat((this.state.maxPigs+this.PEN_UPGRADE_INCREASE).toFixed(2)),!0)}passDay(){const e=this.state.fatteningPigs+this.state.readyPigs,t=parseFloat(Math.min(this.state.feedStock,e*this.FEED_PER_PIG).toFixed(2));if(this.state.feedConsumption=t,this.state.feedStock=parseFloat((this.state.feedStock-t).toFixed(2)),t>=e*this.FEED_PER_PIG){const a=Math.floor(this.state.fatteningPigs*.2);a>0&&(this.state.fatteningPigs=parseFloat((this.state.fatteningPigs-a).toFixed(2)),this.state.readyPigs=parseFloat((this.state.readyPigs+a).toFixed(2)))}}}class R{constructor(){n(this,"state");n(this,"BASE_PORK_PRICE",20);n(this,"BASE_FEED_PRICE",5);n(this,"BASE_PIGLET_PRICE",250);n(this,"PORK_PRICE_FLUCTUATION",.2);n(this,"FEED_PRICE_FLUCTUATION",.2);n(this,"PIGLET_PRICE_FLUCTUATION",.2);n(this,"PIGLET_PRICE_MIN",200);n(this,"PIGLET_PRICE_MAX",300);this.state=this.getInitialState()}getInitialState(){return{porkPrice:this.BASE_PORK_PRICE,feedPrice:this.BASE_FEED_PRICE,pigletPrice:this.BASE_PIGLET_PRICE}}getState(){return{...this.state}}setState(e){this.state={...this.state,...e}}updateMarket(){const e=this.BASE_PORK_PRICE*this.PORK_PRICE_FLUCTUATION;this.state.porkPrice=parseFloat((this.BASE_PORK_PRICE+(Math.random()*e*2-e)).toFixed(2));const t=this.BASE_FEED_PRICE*this.FEED_PRICE_FLUCTUATION;this.state.feedPrice=parseFloat((this.BASE_FEED_PRICE+(Math.random()*t*2-t)).toFixed(2));const a=this.BASE_PIGLET_PRICE*this.PIGLET_PRICE_FLUCTUATION;let s=parseFloat((this.BASE_PIGLET_PRICE+(Math.random()*a*2-a)).toFixed(2));this.state.pigletPrice=parseFloat(Math.max(this.PIGLET_PRICE_MIN,Math.min(this.PIGLET_PRICE_MAX,s)).toFixed(2))}getMarketSummary(){return`猪肉价格：¥${this.state.porkPrice}/kg，饲料价格：¥${this.state.feedPrice}/单位，仔猪价格：¥${this.state.pigletPrice}/只`}}class w{constructor(){n(this,"eventTemplates");this.eventTemplates=[{title:"市场需求上升",description:"最近猪肉市场需求增加，价格可能会上涨。",type:"opportunity",probability:.3,effect:{money:100}},{title:"饲料价格波动",description:"由于天气原因，饲料价格出现了波动。",type:"warning",probability:.25,effect:{money:-50}},{title:"猪群健康问题",description:"部分猪出现了健康问题，需要额外的饲料和护理。",type:"danger",probability:.15,effect:{money:-100,feedStock:-20,fatteningPigs:-1}},{title:"政府补贴",description:"政府推出了养猪补贴政策，你获得了一笔补贴。",type:"opportunity",probability:.1,effect:{money:200}},{title:"技术培训",description:"参加了养猪技术培训，学到了新的养殖方法。",type:"info",probability:.2,effect:{money:-50,fatteningPigs:1}},{title:"新客户订单",description:"收到了一个大额猪肉订单，可以获得额外收入。",type:"opportunity",probability:.15,effect:{money:300}},{title:"设备损坏",description:"猪舍的一些设备损坏了，需要维修。",type:"danger",probability:.1,effect:{money:-150}},{title:"饲料丰收",description:"附近的饲料厂丰收，饲料价格下降。",type:"info",probability:.2,effect:{feedStock:30,money:-50}}]}generateRandomEvent(e){const t=Math.random();let a=0;for(const s of this.eventTemplates)if(a+=s.probability,t<=a)return{id:`event-${Date.now()}-${Math.floor(Math.random()*1e3)}`,title:s.title,description:s.description,type:s.type,day:e,resolved:!1,effect:s.effect};return null}generateDailyEvents(e,t=2){const a=[];for(let s=0;s<t;s++){const i=this.generateRandomEvent(e);i&&a.push(i)}return a}applyEventEffect(e){var t,a,s,i;return{money:((t=e.effect)==null?void 0:t.money)||0,feedStock:((a=e.effect)==null?void 0:a.feedStock)||0,fatteningPigs:((s=e.effect)==null?void 0:s.fatteningPigs)||0,readyPigs:((i=e.effect)==null?void 0:i.readyPigs)||0}}resolveEvent(e){return{...e,resolved:!0}}}class E{constructor(){n(this,"state");n(this,"farmer");n(this,"market");n(this,"eventManager");this.farmer=new A,this.market=new R,this.eventManager=new w,this.state=this.getInitialState()}getInitialState(){return{characterType:"farmer",pigState:{health:100,hunger:50,happiness:70,weight:1,age:0,isAlive:!0},farmerState:this.farmer.getState(),marketState:this.market.getState(),day:1,gameSpeed:3,volume:50,events:[]}}getState(){return{...this.state,farmerState:this.farmer.getState(),marketState:this.market.getState()}}loadState(e){this.state={...e,farmerState:e.farmerState,marketState:e.marketState,events:e.events||[]},this.farmer.setState(e.farmerState),this.market.setState(e.marketState)}farmerBuyFeed(e){return this.farmer.buyFeed(e,this.market.getState().feedPrice)}farmerSellPig(e){const a=100*this.market.getState().porkPrice;return this.farmer.sellPig(e,a)}farmerBuyPig(e){const t=this.market.getState().pigletPrice;return this.farmer.buyPig(e,t)}farmerUpgradePen(){return this.farmer.upgradePen()}passDay(){this.state.day+=1,this.farmer.passDay(),this.market.updateMarket(),this.generateDailyEvents()}generateDailyEvents(){const e=this.eventManager.generateDailyEvents(this.state.day);this.state.events=[...this.state.events,...e]}getEvents(){return this.state.events}resolveEvent(e){const t=this.state.events.findIndex(s=>s.id===e&&!s.resolved);if(t===-1)return!1;const a=this.state.events[t];if(a.effect){const s=this.eventManager.applyEventEffect(a),i=this.farmer.getState();this.farmer.setState({...i,money:parseFloat((i.money+s.money).toFixed(2)),feedStock:parseFloat(Math.max(0,i.feedStock+s.feedStock).toFixed(2)),fatteningPigs:parseFloat(Math.max(0,i.fatteningPigs+(s.fatteningPigs||0)).toFixed(2)),readyPigs:parseFloat(Math.max(0,i.readyPigs+(s.readyPigs||0)).toFixed(2))})}return this.state.events[t]=this.eventManager.resolveEvent(a),!0}setGameSpeed(e){this.state.gameSpeed=Math.max(1,Math.min(5,e))}setVolume(e){this.state.volume=Math.max(0,Math.min(100,e))}getFarmer(){return this.farmer}getMarket(){return this.market}}class h{constructor(e,t,a="pixel-btn"){n(this,"element");this.element=document.createElement("button"),this.element.textContent=e,this.element.className=a,this.element.addEventListener("click",t)}getElement(){return this.element}setText(e){this.element.textContent=e}disable(){this.element.disabled=!0,this.element.classList.add("disabled")}enable(){this.element.disabled=!1,this.element.classList.remove("disabled")}destroy(){this.element.remove()}}class B{constructor(e,t,a){n(this,"element");n(this,"onStartGame");n(this,"onLoadGame");n(this,"onSettings");this.element=document.createElement("div"),this.element.className="page start-page",this.onStartGame=e,this.onLoadGame=t,this.onSettings=a,this.render()}render(){const e=document.createElement("div");e.className="pixel-container";const t=document.createElement("h1");t.className="pixel-title",t.textContent="养猪模拟器",e.appendChild(t);const a=document.createElement("h2");a.className="pixel-subtitle",a.textContent="一个有趣的文字模拟经营游戏",e.appendChild(a);const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.gap="15px",s.style.marginTop="30px";const i=new h("开始游戏",this.onStartGame);s.appendChild(i.getElement());const r=new h("加载游戏",this.onLoadGame);s.appendChild(r.getElement());const l=new h("设置",this.onSettings);s.appendChild(l.getElement()),e.appendChild(s),this.element.appendChild(e)}getElement(){return this.element}}class N{constructor(e,t,a,s,i,r,l){n(this,"element");n(this,"onBuyFeed");n(this,"onSellPig");n(this,"onBuyPig");n(this,"onUpgradePen");n(this,"onNextDay");n(this,"onBack");n(this,"onResolveEvent");n(this,"farmerState");n(this,"marketState");n(this,"events");n(this,"day");this.element=document.createElement("div"),this.element.className="page farmer-game-page",this.onBuyFeed=e,this.onSellPig=t,this.onBuyPig=a,this.onUpgradePen=s,this.onNextDay=i,this.onBack=r,this.onResolveEvent=l,this.farmerState={money:1e3,feedStock:50,feedConsumption:4,fatteningPigs:2,readyPigs:0,maxPigs:5},this.marketState={porkPrice:20,feedPrice:5,pigletPrice:250},this.events=[],this.day=1,this.render()}render(){const e=document.createElement("div");e.className="game-container";const t=document.createElement("h1");t.className="pixel-title",t.textContent="养猪场管理",e.appendChild(t);const a=document.createElement("div");a.className="day-display",a.textContent=`第 ${this.day} 天`,e.appendChild(a);const s=document.createElement("div");s.className="game-main",s.style.display="flex",s.style.gap="30px",s.style.width="100%";const i=this.createEventArea();s.appendChild(i);const r=document.createElement("div");r.style.flex="1",r.style.display="flex",r.style.flexDirection="column",r.style.gap="20px";const l=document.createElement("div");l.className="pixel-container",l.style.width="100%";const d=document.createElement("h3");d.className="pixel-subtitle",d.style.fontSize="20px",d.textContent="农场状态",l.appendChild(d);const o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="repeat(2, 1fr)",o.style.gap="15px",o.appendChild(this.createStatItem("金钱",`¥${this.farmerState.money}`)),o.appendChild(this.createStatItem("饲料库存",`${this.farmerState.feedStock} 单位`)),o.appendChild(this.createStatItem("饲料消耗",`${this.farmerState.feedConsumption} 单位/天`)),o.appendChild(this.createStatItem("育肥猪",`${this.farmerState.fatteningPigs}`)),o.appendChild(this.createStatItem("可出栏猪",`${this.farmerState.readyPigs}`));const m=this.farmerState.fatteningPigs+this.farmerState.readyPigs;o.appendChild(this.createStatItem("总猪数量",`${m}/${this.farmerState.maxPigs}`)),l.appendChild(o),r.appendChild(l);const g=document.createElement("div");g.className="pixel-container",g.style.width="100%";const p=document.createElement("h3");p.className="pixel-subtitle",p.style.fontSize="20px",p.textContent="市场信息",g.appendChild(p);const u=document.createElement("div");u.style.display="grid",u.style.gridTemplateColumns="repeat(2, 1fr)",u.style.gap="15px",u.appendChild(this.createStatItem("猪肉价格",`¥${this.marketState.porkPrice}/kg`)),u.appendChild(this.createStatItem("饲料价格",`¥${this.marketState.feedPrice}/单位`)),u.appendChild(this.createStatItem("仔猪价格",`¥${this.marketState.pigletPrice}/只`)),g.appendChild(u),r.appendChild(g);const y=document.createElement("div");y.className="game-controls",y.style.flexWrap="wrap",y.style.justifyContent="center";const P=new h("购买饲料",()=>this.showQuantityModal("购买饲料",this.onBuyFeed,this.calculateMaxBuyFeed()));y.appendChild(P.getElement());const x=new h("出售猪",()=>this.showQuantityModal("出售猪",this.onSellPig,this.farmerState.readyPigs));y.appendChild(x.getElement());const C=new h("购买猪仔",()=>this.showQuantityModal("购买猪仔",this.onBuyPig,this.calculateMaxBuyPig()));y.appendChild(C.getElement());const I=new h("升级猪舍",this.onUpgradePen);y.appendChild(I.getElement());const S=new h("下一天",this.onNextDay);S.getElement().style.backgroundColor="#2E8B57",S.getElement().style.marginTop="15px",S.getElement().style.padding="15px 30px",S.getElement().style.fontSize="18px",y.appendChild(S.getElement());const F=new h("返回",this.onBack);y.appendChild(F.getElement()),r.appendChild(y),s.appendChild(r),e.appendChild(s),this.element.appendChild(e)}calculateMaxBuyFeed(){return Math.floor(this.farmerState.money/this.marketState.feedPrice)}calculateMaxBuyPig(){const e=this.farmerState.fatteningPigs+this.farmerState.readyPigs,t=this.farmerState.maxPigs-e,a=Math.floor(this.farmerState.money/this.marketState.pigletPrice);return Math.max(0,Math.min(t,a))}showQuantityModal(e,t,a){const s=document.createElement("div");s.className="modal-overlay",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.display="flex",s.style.justifyContent="center",s.style.alignItems="center",s.style.zIndex="1000";const i=document.createElement("div");i.className="pixel-container",i.style.padding="20px",i.style.backgroundColor="#f0e68c",i.style.border="3px solid #000",i.style.borderRadius="8px",i.style.width="300px",i.style.textAlign="center";const r=document.createElement("h3");r.className="pixel-subtitle",r.style.marginBottom="15px",r.textContent=e,i.appendChild(r);const l=document.createElement("div");l.style.marginBottom="15px";const d=document.createElement("label");d.textContent=`数量 (最大: ${a}): `,d.style.display="block",d.style.marginBottom="5px",l.appendChild(d);const o=document.createElement("input");o.type="number",o.min="1",o.max=a.toString(),o.value="1",o.style.padding="8px",o.style.fontSize="16px",o.style.border="2px solid #000",o.style.borderRadius="4px",o.style.width="100px",o.style.textAlign="center",l.appendChild(o),i.appendChild(l);const m=document.createElement("div");m.style.display="flex",m.style.justifyContent="space-around",m.style.marginTop="20px";const g=new h("确认",()=>{const u=parseInt(o.value);u>=1&&u<=a&&(t(u),s.remove())});m.appendChild(g.getElement());const p=new h("取消",()=>{s.remove()});m.appendChild(p.getElement()),i.appendChild(m),s.appendChild(i),document.body.appendChild(s),o.focus()}createEventArea(){const e=document.createElement("div");e.className="pixel-container",e.style.width="250px",e.style.height="auto",e.style.minHeight="400px",e.style.display="flex",e.style.flexDirection="column";const t=document.createElement("h3");t.className="pixel-subtitle",t.style.fontSize="20px",t.textContent="今日事件",e.appendChild(t);const a=document.createElement("div");if(a.className="event-list",a.style.flex="1",a.style.overflowY="auto",a.style.marginTop="15px",this.events.length===0){const s=document.createElement("div");s.className="event-item event-info",s.style.padding="10px",s.style.textAlign="center",s.textContent="今天没有特殊事件发生。",a.appendChild(s)}else{const s=this.events.filter(i=>i.day===this.day);if(s.length===0){const i=document.createElement("div");i.className="event-item event-info",i.style.padding="10px",i.style.textAlign="center",i.textContent="今天没有特殊事件发生。",a.appendChild(i)}else s.forEach(i=>{const r=this.createEventItem(i);a.appendChild(r)})}return e.appendChild(a),e}createEventItem(e){const t=document.createElement("div");switch(t.className=`event-item event-${e.type} ${e.resolved?"resolved":""}`,t.style.padding="10px",t.style.marginBottom="10px",t.style.borderRadius="4px",t.style.border="2px solid #000",t.style.backgroundColor="#FFFACD",t.style.cursor=e.resolved?"default":"pointer",t.style.opacity=e.resolved?"0.7":"1",e.type){case"opportunity":t.style.backgroundColor="#98FB98";break;case"warning":t.style.backgroundColor="#FFD700";break;case"danger":t.style.backgroundColor="#FFB6C1";break}const a=document.createElement("h4");a.style.fontSize="14px",a.style.fontWeight="bold",a.style.marginBottom="5px",a.textContent=e.title,e.resolved&&(a.textContent+=" (已解决)"),t.appendChild(a);const s=document.createElement("p");s.style.fontSize="12px",s.textContent=e.description,t.appendChild(s);const i=this.getEventEffectText(e.title);if(i){const r=document.createElement("p");r.style.fontSize="12px",r.style.fontWeight="bold",r.style.marginTop="5px",r.style.color=i.includes("增加")?"#2E8B57":"#DC143C",r.textContent=i,t.appendChild(r)}if(!e.resolved){const r=document.createElement("button");r.textContent="解决",r.style.marginTop="10px",r.style.padding="5px 10px",r.style.fontSize="12px",r.style.border="2px solid #000",r.style.borderRadius="4px",r.style.backgroundColor="#4CAF50",r.style.color="white",r.style.cursor="pointer",r.onclick=l=>{l.stopPropagation(),this.onResolveEvent(e.id)},t.appendChild(r)}return e.resolved||(t.onclick=()=>{this.onResolveEvent(e.id)}),t}getEventEffectText(e){switch(e){case"市场需求上升":return"金钱增加：+¥100";case"饲料价格波动":return"金钱减少：-¥50";case"猪群健康问题":return"金钱减少：-¥100，饲料减少：-20单位，育肥猪减少：-1头";case"政府补贴":return"金钱增加：+¥200";case"技术培训":return"金钱减少：-¥50，育肥猪增加：+1头";case"新客户订单":return"金钱增加：+¥300";case"设备损坏":return"金钱减少：-¥150";case"饲料丰收":return"饲料增加：+30单位，金钱减少：-¥50";default:return""}}createStatItem(e,t){const a=document.createElement("div");return a.className="stat-item",a.innerHTML=`<span>${e}:</span> <span>${t}</span>`,a}updateState(e,t,a=[],s=1){this.farmerState=e,this.marketState=t,this.events=a,this.day=s,this.element.innerHTML="",this.render()}getElement(){return this.element}}class T{constructor(e,t,a){n(this,"element");n(this,"onBack");n(this,"onSaveSettings");n(this,"onClearSaves");n(this,"gameSpeed",3);n(this,"volume",50);this.element=document.createElement("div"),this.element.className="page settings-page",this.onBack=e,this.onSaveSettings=t,this.onClearSaves=a,this.render()}render(){const e=document.createElement("div");e.className="pixel-container";const t=document.createElement("h1");t.className="pixel-title",t.textContent="设置",e.appendChild(t);const a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.gap="20px",a.style.marginTop="20px";const s=this.createSliderSetting("游戏速度",1,5,this.gameSpeed,p=>{this.gameSpeed=p});a.appendChild(s);const i=this.createSliderSetting("音量",0,100,this.volume,p=>{this.volume=p});a.appendChild(i),e.appendChild(a);const r=document.createElement("div");r.style.marginTop="30px";const l=document.createElement("h3");l.className="pixel-subtitle",l.style.fontSize="20px",l.textContent="存档管理",r.appendChild(l);const d=new h("清除所有存档",()=>{confirm("确定要清除所有存档吗？此操作不可恢复！")&&this.onClearSaves()});r.appendChild(d.getElement()),e.appendChild(r);const o=document.createElement("div");o.style.display="flex",o.style.justifyContent="center",o.style.gap="15px",o.style.marginTop="30px";const m=new h("保存设置",()=>{this.onSaveSettings(this.gameSpeed,this.volume)});o.appendChild(m.getElement());const g=new h("返回",this.onBack);o.appendChild(g.getElement()),e.appendChild(o),this.element.appendChild(e)}createSliderSetting(e,t,a,s,i){const r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.gap="10px";const l=document.createElement("div");l.className="pixel-text",l.style.fontWeight="bold",l.textContent=e,r.appendChild(l);const d=document.createElement("div");d.style.display="flex",d.style.alignItems="center",d.style.gap="10px";const o=document.createElement("input");o.type="range",o.min=t.toString(),o.max=a.toString(),o.value=s.toString(),o.className="slider",o.style.flex="1",o.style.height="10px",o.style.accentColor="#8B4513",o.addEventListener("input",g=>{const p=parseInt(g.target.value);i(p),m.textContent=p.toString()});const m=document.createElement("span");return m.className="pixel-text",m.textContent=s.toString(),m.style.minWidth="30px",m.style.textAlign="right",d.appendChild(o),d.appendChild(m),r.appendChild(d),r}getElement(){return this.element}setInitialValues(e,t){this.gameSpeed=e,this.volume=t,this.element.innerHTML="",this.render()}}class f{static getAllSaves(){const e=localStorage.getItem(this.SAVE_KEY);return e?JSON.parse(e):[]}static saveGame(e,t){const a=this.getAllSaves(),s={id:Date.now().toString(),name:e,timestamp:Date.now(),state:t};a.push(s),localStorage.setItem(this.SAVE_KEY,JSON.stringify(a))}static autoSave(e){localStorage.setItem(this.AUTO_SAVE_KEY,JSON.stringify(e))}static loadAutoSave(){const e=localStorage.getItem(this.AUTO_SAVE_KEY);return e?JSON.parse(e):null}static loadGame(e){const a=this.getAllSaves().find(s=>s.id===e);return a?a.state:null}static deleteSave(e){const a=this.getAllSaves().filter(s=>s.id!==e);localStorage.setItem(this.SAVE_KEY,JSON.stringify(a))}static clearAllSaves(){localStorage.removeItem(this.SAVE_KEY),localStorage.removeItem(this.AUTO_SAVE_KEY)}}n(f,"SAVE_KEY","pigFarmSimulator_saves"),n(f,"AUTO_SAVE_KEY","pigFarmSimulator_autoSave");class M{constructor(){n(this,"listeners",new Map)}subscribe(e,t){var a;this.listeners.has(e)||this.listeners.set(e,[]),(a=this.listeners.get(e))==null||a.push(t)}unsubscribe(e,t){const a=this.listeners.get(e);if(a){const s=a.indexOf(t);s!==-1&&a.splice(s,1)}}publish(e){const t=this.listeners.get(e.type);t&&t.forEach(a=>a(e))}clear(){this.listeners.clear()}}class G{constructor(e){n(this,"router");n(this,"gameState");n(this,"eventService");n(this,"autoSaveInterval",null);n(this,"startPage");n(this,"farmerGamePage");n(this,"settingsPage");this.router=new _(e),this.gameState=new E,this.eventService=new M,this.startPage=new B(()=>this.startGame(),()=>this.loadGame(),()=>this.router.navigate("settings")),this.farmerGamePage=new N(t=>this.handleFarmerAction("buyFeed",t),t=>this.handleFarmerAction("sellPig",t),t=>this.handleFarmerAction("buyPig",t),()=>this.handleFarmerAction("upgradePen"),()=>this.nextDay(),()=>this.router.navigate("start"),t=>this.resolveEvent(t)),this.settingsPage=new T(()=>this.router.navigate("start"),(t,a)=>this.saveSettings(t,a),()=>this.clearSaves())}init(){this.router.registerRoute("start",this.startPage.getElement()),this.router.registerRoute("farmer-game",this.farmerGamePage.getElement()),this.router.registerRoute("settings",this.settingsPage.getElement());const e=f.loadAutoSave();e&&(this.gameState.loadState(e),this.updateGameUI()),this.router.init(),this.autoSaveInterval=window.setInterval(()=>{this.autoSave()},3e4)}nextDay(){this.gameState.passDay(),this.updateGameUI(),this.autoSave()}startGame(){this.router.navigate("farmer-game"),this.updateGameUI()}loadGame(){const e=f.loadAutoSave();e&&(this.gameState.loadState(e),this.router.navigate("farmer-game"),this.updateGameUI())}handleFarmerAction(e,t=1){let a=!0;switch(e){case"buyFeed":a=this.gameState.farmerBuyFeed(t);break;case"sellPig":a=this.gameState.farmerSellPig(t);break;case"buyPig":a=this.gameState.farmerBuyPig(t);break;case"upgradePen":a=this.gameState.farmerUpgradePen();break}a?(this.updateGameUI(),this.autoSave()):console.log("Action failed!")}saveSettings(e,t){this.gameState.setGameSpeed(e),this.gameState.setVolume(t),this.autoSave()}clearSaves(){f.clearAllSaves(),this.gameState=new E,this.updateGameUI()}resolveEvent(e){this.gameState.resolveEvent(e)&&(this.updateGameUI(),this.autoSave())}autoSave(){const e=this.gameState.getState();f.autoSave(e)}updateGameUI(){const e=this.gameState.getState();this.farmerGamePage.updateState(e.farmerState,e.marketState,e.events,e.day)}destroy(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval),this.eventService.clear()}}const v=document.getElementById("app");v&&new G(v).init();
//# sourceMappingURL=index-0le9uUnr.js.map
